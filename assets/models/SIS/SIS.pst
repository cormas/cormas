<?xml version="1.0"?><st-source><!-- Name: SISPackageName: SISParcel: #('SIS')ParcelName: SISDate: 9:46:39 am March 31, 2020 --><time-stamp>From VisualWorks® NonCommercial, 7.6 of lundi 3 mars 2008 on mardi 31 mars 2020 at 9:46:39</time-stamp><do-it>(Dialog confirm: 'You are filing-in a Parcel source file!\\While this is possible it will not have\the same effect as loading the parcel.\None of the Parcel''s prerequisites will\be loaded and none of its load actions\will be performed.\\Are you sure you want to file-in?' withCRs) ifFalse: [self error: 'Parcel file-in abandoned.  Choose terminate or close.']</do-it><name-space><name>SIS</name><environment>CormasNS.Models</environment><private>false</private><imports>			private Smalltalk.*			private CormasNS.Kernel.*			</imports><category>SISCategory</category><attributes><package>SIS</package></attributes></name-space><class><name>Cell</name><environment>CormasNS.Models.SIS</environment><super>CormasNS.Kernel.SpatialEntityElement</super><private>false</private><indexed-type>none</indexed-type><inst-vars></inst-vars><class-inst-vars></class-inst-vars><imports></imports><category>SISCategory</category><attributes><package>SIS</package></attributes></class><class><name>Host</name><environment>CormasNS.Models.SIS</environment><super>CormasNS.Kernel.AgentLocation</super><private>false</private><indexed-type>none</indexed-type><inst-vars>state sickDays </inst-vars><class-inst-vars>infectiousRate infectiousPeriod beta infectionProbability </class-inst-vars><imports></imports><category>SISCategory</category><attributes><package>SIS</package></attributes></class><class><name>SIS</name><environment>CormasNS.Models.SIS</environment><super>CormasNS.Kernel.CormasModel</super><private>false</private><indexed-type>none</indexed-type><inst-vars>theHosts hostPopSize initPropInfectious aggregSusceptibles aggregInfected theCells </inst-vars><class-inst-vars></class-inst-vars><imports></imports><category>SISCategory</category><attributes><package>SIS</package></attributes></class><methods><class-id>CormasNS.Models.SIS.Cell class</class-id> <category>testing</category><body package="SIS" selector="isAbstract">isAbstract ^false</body></methods><methods><class-id>CormasNS.Models.SIS.Cell class</class-id> <category>pov symbols</category><body package="SIS" selector="defaultColor">defaultColor"Returns an array containing the settings of a Spatial entity pov symbol in the following order:(color red) (color green) (color blue)(Automatically defined by Cormas)."^Array with: 1.0 with: 1.0 with: 1.0</body></methods><methods><class-id>CormasNS.Models.SIS.Host</class-id> <category>accessing</category><body package="SIS" selector="sickDays:">sickDays: aSmallInteger 	"Setter accessor of attribute infectiousSince (Unit: days). 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!  "	sickDays := aSmallInteger</body><body package="SIS" selector="state">state	"Getter accessor with initial value = 'S'. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !! "	^state ifNil:[state := 'S']</body><body package="SIS" selector="state:">state: anObject	"Setter accessor of attribute state. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!  "	state = anObject ifTrue:[^nil].   "for optimization"	state := anObject.	self changed</body></methods><methods><class-id>CormasNS.Models.SIS.Host</class-id> <category>* control</category><body package="SIS" selector="fightVirus">fightVirus		self sickDays: self sickDays + 1.	self sickDays &gt; Host infectiousPeriod		ifTrue:			[self sickDays: 0.			self recover]</body><body package="SIS" selector="fightVirusWithNoMemory">fightVirusWithNoMemory		Cormas random &lt; (1 / Host infectiousPeriod) ifTrue: [self recover]</body><body package="SIS" selector="infectNeighbours">infectNeighbours		((self nearestSimilarAgentsWithinRadius: 1) select: [:h | h isSusceptible])		do: [:anHost | Cormas random &lt; Host infectionProbability ifTrue: [anHost becomeInfectious]].		"do: [:anHost | Cormas random &lt; Host infectiousRate ifTrue: [anHost becomeInfectious]]."</body><body package="SIS" selector="infectPopulation:">infectPopulation: pop		| ag |	pop isEmpty ifTrue:[^nil].	ag := Cormas selectRandomlyFrom: pop.	ag isSusceptible ifFalse:[^nil].	Cormas random &lt; Host infectionProbability ifTrue: [ag becomeInfectious]</body><body package="SIS" selector="jump">jumpself randomJump.</body><body package="SIS" selector="move">moveself randomWalk.</body></methods><methods><class-id>CormasNS.Models.SIS.Host</class-id> <category>pov</category><body package="SIS" selector="povSick">povSick		^self state asSymbol</body></methods><methods><class-id>CormasNS.Models.SIS.Host</class-id> <category>epidemicState</category><body package="SIS" selector="becomeInfectious">becomeInfectiousself state: 'I'</body><body package="SIS" selector="recover">recover self state: 'S'</body></methods><methods><class-id>CormasNS.Models.SIS.Host</class-id> <category>probes</category><body package="SIS" selector="sickDays">sickDays	"Getter accessor with initial value = 0 days. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !! "	^sickDays ifNil:[sickDays := 0]</body></methods><methods><class-id>CormasNS.Models.SIS.Host</class-id> <category>testing</category><body package="SIS" selector="isInfectious">isInfectious^ self state = 'I'</body><body package="SIS" selector="isSusceptible">isSusceptible^ self state = 'S'</body></methods><methods><class-id>CormasNS.Models.SIS.Host class</class-id> <category>testing</category><body package="SIS" selector="isAbstract">isAbstract ^false</body></methods><methods><class-id>CormasNS.Models.SIS.Host class</class-id> <category>+ parameter unit</category><body package="SIS" selector="beta_type">beta_type 	"Return the type of attribute #beta.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^Float</body><body package="SIS" selector="beta_unit">beta_unit 	"Return the unit of attribute #beta.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ '%'</body><body package="SIS" selector="infectionProbability_type">infectionProbability_type 	"Return the type of attribute #infectionProbability.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^Float</body><body package="SIS" selector="infectionProbability_unit">infectionProbability_unit 	"Return the unit of attribute #infectionProbability.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ '%'</body><body package="SIS" selector="infectiousPeriod_type">infectiousPeriod_type 	"Return the type of attribute #infectiousPeriod.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^SmallInteger</body><body package="SIS" selector="infectiousPeriod_unit">infectiousPeriod_unit 	"Return the unit of attribute #infectiousPeriod.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ 'days'</body><body package="SIS" selector="infectiousSince_type">infectiousSince_type 	"Return the type of attribute #infectiousSince.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^SmallInteger</body><body package="SIS" selector="infectiousSince_unit">infectiousSince_unit 	"Return the unit of attribute #infectiousSince.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ 'days'</body><body package="SIS" selector="state_type">state_type 	"Return the type of attribute #state.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ByteString</body></methods><methods><class-id>CormasNS.Models.SIS.Host class</class-id> <category>- default value</category><body package="SIS" selector="beta_default">beta_default 	"Return the default value of attribute #beta : 0.3.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^0.3</body><body package="SIS" selector="infectionProbability_default">infectionProbability_default 	"Return the default value of attribute #infectionProbability : 0.333915.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^0.333915</body><body package="SIS" selector="infectiousPeriod_default">infectiousPeriod_default 	"Return the default value of attribute #infectiousPeriod : 10.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^10</body><body package="SIS" selector="infectiousRate_default">infectiousRate_default 	"Return the default value of attribute #infectiousRate : 0.3.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^0.3</body><body package="SIS" selector="infectiousSince_default">infectiousSince_default 	"Return the default value of attribute #infectiousSince : 0.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^0</body><body package="SIS" selector="k_default">k_default 	"Return the default value of attribute #k : 0.3.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^0.3</body><body package="SIS" selector="sickDays_default">sickDays_default 	"Return the default value of attribute #sickDays : 0.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^0</body><body package="SIS" selector="state_default">state_default 	"Return the default value of attribute #state : 'S'.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^'S'</body></methods><methods><class-id>CormasNS.Models.SIS.Host class</class-id> <category>pov symbols</category><body package="SIS" selector="defaultColor">defaultColor "Returns the default color (Automatically defined by Cormas)." ^(ColorValue red: 1.0 green: 0.199976 blue: 0.800024)</body><body package="SIS" selector="VectorialPOV_Host">VectorialPOV_Host"Returns an array containing the settings of a Situated entity vectorial pov symbol in the following order:(color red) (color green) (color blue) (lineColor red) (lineColor green) (lineColor blue) lineWidth sizeratio position (array of outline vertices) isDistortable." ^#(1.0 0.199976 0.800024 0.0 0.0 0.0 1 1 #random #(4.45856e-7@-10.2 8.83346@-5.1 8.83346@5.1 -1.21634e-7@10.2 -8.83346@5.1 -8.83346@-5.1 3.44522e-6@-10.2) true)</body><body package="SIS" selector="VectorialPOV_I">VectorialPOV_I"Returns an array containing the settings of a Situated entity vectorial pov symbol in the following order:(color red) (color green) (color blue) (lineColor red) (lineColor green) (lineColor blue) lineWidth sizeratio position (array of outline vertices) isDistortable." ^#(1.0 0.0 0.0 0.0 0.0 0.0 0 1 #border_bottomRight #(12.75@28.6875 7.65@28.6875 1.275@10.8375 -7.65@28.6875 -12.75@28.6875 -6.375@8.2875 -7.65@-4.4625 -28.05@-9.5625 -30.6@-12.1125 -5.1@-12.1125 -8.925@-18.4875 -8.925@-22.3125 -8.925@-27.4125 -3.825@-31.2375 2.55@-31.2375 7.65@-28.6875 8.925@-24.8625 8.925@-18.4875 6.375@-14.6625 3.825@-12.1125 29.325@-10.8375 25.5@-9.5625 8.925@-4.4625 8.925@9.5625 12.75@29.9625) false)</body><body package="SIS" selector="VectorialPOV_S">VectorialPOV_S"Returns an array containing the settings of a Situated entity vectorial pov symbol in the following order:(color red) (color green) (color blue) (lineColor red) (lineColor green) (lineColor blue) lineWidth sizeratio position (array of outline vertices) isDistortable." ^#(0.0 0.670004 0.0 0.0 0.746917 0.0 1 1 #border_bottomRight #(11.0@24.0 6.0@24.0 1.0@9.0 -6.0@24.0 -10.0@24.0 -5.0@7.0 -6.0@-4.0 -24.0@-8.0 -26.0@-10.0 -4.0@-10.0 -7.0@-15.0 -8.0@-18.0 -7.0@-22.0 -4.0@-26.0 2.0@-26.0 6.0@-24.0 7.0@-20.0 7.0@-16.0 6.0@-13.0 4.0@-10.0 25.0@-9.0 22.0@-7.0 7.0@-4.0 7.0@9.0 11.0@25.0) false)</body></methods><methods><class-id>CormasNS.Models.SIS.Host class</class-id> <category>accessing</category><body package="SIS" selector="beta">beta	"Getter accessor with initial value = 0.3 %. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !! "	^beta ifNil:[beta := 0.3]</body><body package="SIS" selector="beta:">beta: aFloat 	"Setter accessor of attribute beta (Unit: %). 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!  "	beta := aFloat</body><body package="SIS" selector="infectionProbability">infectionProbability	"Getter accessor with initial value = 0.333915 %. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !! "	^infectionProbability ifNil:[infectionProbability := 0.333915]</body><body package="SIS" selector="infectionProbability:">infectionProbability: aFloat 	"Setter accessor of attribute infectionProbability (Unit: %). 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!  "	infectionProbability := aFloat</body><body package="SIS" selector="infectiousPeriod">infectiousPeriod	"Getter accessor with initial value = 10 days. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !! "	^infectiousPeriod ifNil:[infectiousPeriod := 10]</body><body package="SIS" selector="infectiousPeriod:">infectiousPeriod: aSmallInteger 	"Setter accessor of attribute infectiousPeriod (Unit: days). 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!  "	infectiousPeriod := aSmallInteger</body><body package="SIS" selector="infectiousRate">infectiousRate	"Getter accessor with initial value = 0.3 %resistance. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !! "	^infectiousRate ifNil:[infectiousRate := 0.3]</body><body package="SIS" selector="infectiousRate:">infectiousRate: aFloat 	"Setter accessor of attribute k (Unit: %resistance). 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!  "	infectiousRate := aFloat</body></methods><methods><class-id>CormasNS.Models.SIS.Host class</class-id> <category>- probes</category><body package="SIS" selector="colorOfProbe_sickDays">colorOfProbe_sickDays  ^ ColorValue red</body></methods><methods><class-id>CormasNS.Models.SIS.SIS</class-id> <category>init</category><body package="SIS" selector="initNoGui">initNoGui		| infectedNum initialInfectedAgents |	self initSpace. 	self setBeta.	self createN: self hostPopSize randomlyLocatedEntities: Host.	infectedNum := (self initPropInfectious / 100 * self hostPopSize) rounded.	initialInfectedAgents := self pickN: infectedNum entities: Host.	self ask: initialInfectedAgents toDo: #becomeInfectious."** Aggregated **"	self initAggregatedModel</body><body package="SIS" selector="initWithGUI">initWithGUI"Init then opens a spatial grid"		self initNoGui.	self displayPov: #defaultPOV of: Cell.	self displayPov: #povSick of: Host</body></methods><methods><class-id>CormasNS.Models.SIS.SIS</class-id> <category>control</category><body package="SIS" selector="a_macro:">a_macro: t	"The model calculates the number of infected and susceptible agents according to the discrete equation (with delta T = 1). Here, the agents do nothing: there state is changed by an outside operator: the result of the global model.	Must be initialized with at least 1000 hosts"	| txNewInfected nbNewSusceptibles |	txNewInfected := Host infectionProbability * self theSusceptibles size		/ self theHosts size * self theInfected size / self theHosts size.	(self theSusceptibles copyFrom: 1 to: (txNewInfected * self theHosts size) rounded)		do: [:ag | ag becomeInfectious].	nbNewSusceptibles := (1 / Host infectiousPeriod * self theInfected size) rounded.		(self theInfected copyFrom: 1 to: nbNewSusceptibles)		do: [:ag | ag recover].	"** Aggregated **"	self stepAggregatedModel</body><body package="SIS" selector="b_NoSpatialNoMemory:">b_NoSpatialNoMemory: t	"The agents are not situated. They meet randomly. When infected, an agent has a probability of 10% to recover each day."	self theInfected  do: [:ag | ag infectPopulation: (self theHosts)].	self ask: self theInfected toDo: #fightVirusWithNoMemory.	"** Aggregated **"	self stepAggregatedModel</body><body package="SIS" selector="c_NoSpatialInfectiousPeriod:">c_NoSpatialInfectiousPeriod: t	"The agents are not situated. They meet randomly. When infected, an agent is infectious during 10 days."	self theInfected  do: [:ag | ag infectPopulation: (self theHosts)].	self ask: self theInfected toDo: #fightVirus.	"** Aggregated **"	self stepAggregatedModel</body><body package="SIS" selector="d_NoMemory:">d_NoMemory: t	"The agents are situated. They can meet each other when moving randomly. When infected, an agent has a probability of 10% to recover each day."	self ask: Host toDo: #move.	self ask: (self theInfected) toDo: #infectNeighbours.	self ask: (self theInfected) toDo: #fightVirusWithNoMemory."** Aggregated **"	self stepAggregatedModel.</body><body package="SIS" selector="e_InfectiousPeriod:">e_InfectiousPeriod: t	"The agents are situated and move randomly. When infected, an agent is infectious during 10 days."	self ask: Host toDo: #randomWalk.	self ask: (self theInfected) toDo: #infectNeighbours.	self ask: (self theInfected) toDo: #fightVirus."** Aggregated **"	self stepAggregatedModel.</body><body package="SIS" selector="f_JumpInfectiousPeriod:">f_JumpInfectiousPeriod: t	"The agents are situated and jump to a random plot. When infected, an agent has a probability of 10% to recover each day."	self ask: Host toDo: #jump.	self ask: (self theInfected) toDo: #infectNeighbours.	self ask: (self theInfected) toDo: #fightVirus "WithNoMemory"."** Aggregated **"	self stepAggregatedModel.</body><body package="SIS" selector="g_JumpNoMemory:">g_JumpNoMemory: t	"The agents are situated and jump randomly. When infected, an agent is infectious during 10 days"	self ask: Host toDo: #jump.	self ask: (self theInfected) toDo: #infectNeighbours.	self ask: (self theInfected) toDo: #fightVirusWithNoMemory."** Aggregated **"	self stepAggregatedModel.</body></methods><methods><class-id>CormasNS.Models.SIS.SIS</class-id> <category>probes</category><body package="SIS" selector="aggregINFECTED">aggregINFECTED^ self aggregInfected asFloat</body><body package="SIS" selector="aggregSUSCEP">aggregSUSCEP^ self aggregSusceptibles asFloat</body><body package="SIS" selector="indivINFECTED">indivINFECTED	"return the data (a number) to be recorded"		^(self theInfected size / self theHosts size) asFloat</body><body package="SIS" selector="indivSUSCEPT">indivSUSCEPT"return the data (a number) to be recorded"^((self theSusceptibles) size / self theHosts size) asFloat</body></methods><methods><class-id>CormasNS.Models.SIS.SIS</class-id> <category>accessing</category><body package="SIS" selector="aggregInfected:">aggregInfected: aSmallInteger 	"Setter accessor of attribute aggregInfected (Unit: %). 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!  "	aggregInfected := aSmallInteger</body><body package="SIS" selector="aggregSusceptibles:">aggregSusceptibles: aSmallInteger 	"Setter accessor of attribute aggregSusceptibles (Unit: %). 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!  "	aggregSusceptibles := aSmallInteger</body><body package="SIS" selector="hostPopSize">hostPopSize	"Getter accessor with initial value = 1000 agents. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !! "	^hostPopSize ifNil:[hostPopSize := 1000]</body><body package="SIS" selector="hostPopSize:">hostPopSize: aSmallInteger 	"Setter accessor of attribute hostPopSize (Unit: agents). 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!  "	hostPopSize := aSmallInteger</body><body package="SIS" selector="initPropInfectious">initPropInfectious	"Getter accessor with initial value = 1 %. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !! "	^initPropInfectious ifNil:[initPropInfectious := 1]</body><body package="SIS" selector="initPropInfectious:">initPropInfectious: aSmallInteger 	"Setter accessor of attribute initPropInfectious (Unit: %). 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!  "	initPropInfectious := aSmallInteger</body><body package="SIS" selector="theCells">theCells	"Returns a collection of all the instances of the sub classes collected by cormasModel.	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"^theCells ifNil:[theCells := IndexedSet new]</body><body package="SIS" selector="theCells:">theCells: aNewCollection	"Set a new collection for theXXXs attribute.	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	theCells := aNewCollection</body><body package="SIS" selector="theHosts">theHosts	"Returns a collection of all the instances of the sub classes collected by cormasModel.	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"^theHosts ifNil:[theHosts := IndexedSet new]</body><body package="SIS" selector="theHosts:">theHosts: aNewCollection	"Set a new collection for theXXXs attribute.	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	theHosts := aNewCollection</body><body package="SIS" selector="theInfected">theInfected		^self theHosts select: [:h | h isInfectious]</body><body package="SIS" selector="theSusceptibles">theSusceptibles		^self theHosts select: [:h | h isInfectious not]</body></methods><methods><class-id>CormasNS.Models.SIS.SIS</class-id> <category>aggregatedModel</category><body package="SIS" selector="aggregInfected">aggregInfected	"Getter accessor with initial value = 1 %. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !! "	^aggregInfected ifNil:[aggregInfected := 1]</body><body package="SIS" selector="aggregSusceptibles">aggregSusceptibles	"Getter accessor with initial value = 99 %. 	This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !! "	^aggregSusceptibles ifNil:[aggregSusceptibles := 99]</body><body package="SIS" selector="initAggregatedModel">initAggregatedModel		self aggregInfected: self theInfected size / self hostPopSize.	self aggregSusceptibles: self theSusceptibles size / self hostPopSize</body><body package="SIS" selector="stepAggregatedModel">stepAggregatedModel	"2 differential equations system:		dS/dt = -beta.I.S + gamma.I		dI/dt = beta.I.S - gamma.I	Discretization: dt =&gt; deltaT = 0.01.	S(t+1) - S(t) / deltaT = -beta.I.S + gamma.I	S(t+1) = S(t) + deltaT .(-beta.I.S + gamma.I) 	I(t+1) = I(t) + deltaT .(+beta.I.S - gamma.I)  At equilibrium: S* = gamma/beta  &amp;    I* = 1 - gamma/beta  " 		"self stepAggregatedModelBruno"	self stepAggregatedModel_PB</body><body package="SIS" selector="stepAggregatedModelBruno">stepAggregatedModelBruno	"Le parametre gamma correspond au taux de guerison moyen des individus de la population. 	Le parametre ß est moins facile a apprehender intuitivement. Ce parametre peut s’exprimer sous la forme ß = -k log(1 - c) 	ou k est le nombre de contacts moyen entre deux individus par unite de temps et c est la probabilite qu’un contact entre un individu susceptible et individu infectieux entraine une infection."	| b gamma c k |	k := 9 / self theCells size * self hostPopSize. "k est le nombre de contacts moyen entre deux individus par unite de temps"	c := Host infectiousRate. c:=  Host infectionProbability.	b := (0 - k) * (1 - c) log.	gamma := 1 / Host infectiousPeriod.	"self i: self i + (((b * self i * self s) - (g * self i))).self s: 1 - self i"	100 timesRepeat:			[self aggregInfected: self aggregInfected +							((b * self aggregInfected * self aggregSusceptibles - (gamma * self aggregInfected)) * 0.01).			self aggregSusceptibles: 1 - self aggregInfected]</body><body package="SIS" selector="stepAggregatedModel_PB">stepAggregatedModel_PB	"Le parametre gamma correspond au taux de guerison moyen des individus de la population. 	Le parametre ß est moins facile a apprehender intuitivement. Ce parametre peut s’exprimer sous la forme ß = -k log(1 - c) 	ou k est le nombre de contacts moyen entre deux individus par unite de temps et c est la probabilite qu’un contact entre un individu susceptible et individu infectieux entraine une infection."	"2 differential equations system:		dS/dt = -beta.I.S + gamma.I		dI/dt = beta.I.S - gamma.I	Discretization: dt =&gt; deltaT = 0.01.	S(t+1) - S(t) / deltaT = -beta.I.S + gamma.I	S(t+1) = S(t) + deltaT .(-beta.I.S + gamma.I) 	I(t+1) = I(t) + deltaT .(+beta.I.S - gamma.I)  At equilibrium: S* = gamma/beta  &amp;    I* = 1 - gamma/beta  " 	| beta gamma deltaT |	"k := 9 / self theCells size * self hostPopSize." "k est le nombre de contacts moyen entre deux individus par unite de temps"	"beta :=  (0 - k) * (1 - Host infectionProbability) log." "proba infection=0.3"	beta := Host beta.	gamma := 1 / Host infectiousPeriod.	deltaT := 1. "if deltaT between 1 and 0.000005, there is almost no difference"	(1/deltaT) rounded timesRepeat:			[self aggregInfected: self aggregInfected +				((beta * self aggregInfected * self aggregSusceptibles - (gamma * self aggregInfected)) * deltaT).			self aggregSusceptibles: 1 - self aggregInfected]</body></methods><methods><class-id>CormasNS.Models.SIS.SIS</class-id> <category>init space</category><body package="SIS" selector="calculateSpatialDimensions">calculateSpatialDimensions	"Le parametre ß peut s’exprimer sous la forme :ß = -k log(1 - c) 	ou k est le nombre de contacts moyen entre deux individus par unite de temps et c est la probabilite qu’un contact entre un individu susceptible et individu infectieux entraine une infection."		| k root |	k := 1.7.	root := (9 / k * self hostPopSize) sqrt.	root isInteger		ifTrue: [^Array with: root with: root]		ifFalse:			[^Array				with: root floor				with: root ceiling]</body><body package="SIS" selector="initSpace">initSpace		| linesCols |	linesCols := self calculateSpatialDimensions.	self createGridX: (linesCols first) Y: (linesCols last) neighbourhood: 8 closed: false. </body><body package="SIS" selector="setBeta">setBeta	"Le parametre ß peut s’exprimer sous la forme :ß = -k log(1 - c) 	ou k est le nombre de contacts moyen entre deux individus par unite de temps et c est la probabilite qu’un contact entre un individu susceptible et individu infectieux entraine une infection."	| k |	k := 9 / self theCells size * self hostPopSize. "k est le nombre de contacts moyen entre deux individus par unite de temps"	Host beta:  (0 - k) * ((1 - Host infectionProbability) log).Cormas println: 'Beta = ', Host beta printString</body></methods><methods><class-id>CormasNS.Models.SIS.SIS class</class-id> <category>description</category><body package="SIS" selector="authors">authors^ 'Bruno BontePierre Bommel'	</body><body package="SIS" selector="comments">comments^ 'IBM version of SIS epidemiologic Model.A population of 1000 individuals is randomly distributed on a torroidal spatial grid of 73x72 cells (5256). At beginning, 1% of the population is sick (infected). Moving randomly, each person can meat another person, who can be infected, and is this case it can become infected in its turn.The model compares an aggregated simulation with ABM results.For more explanation, see: http://cormas.cirad.fr/en/applica/SIS.html'	</body><body package="SIS" selector="cormasCompatibleVersion">cormasCompatibleVersion^ #(2020 3 31 6 38 27)</body><body package="SIS" selector="creationDate">creationDate^ 'March 4, 2017'	</body><body package="SIS" selector="currentDeveloperName">currentDeveloperName^ 'Bruno Bonte'	</body><body package="SIS" selector="emails">emails^ 'bruno.bonte@irstea.frbommel@cirad.fr'	</body><body package="SIS" selector="lastUpdate">lastUpdate^ 'mardi 31 mars 2020'	</body><body package="SIS" selector="version">version^ 'SIS.pcl'	</body><body package="SIS" selector="versionComments">versionComments^ '  --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2017.3.3 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.10.31 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.10.31 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.10.31 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.10.31 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.10.31 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.10.31 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.10.31 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.11.9 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.11.9 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.11.9 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.11.9 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.11.9 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.11.9 *** Developer: Bruno Bonte *** --------------------- SIS_PBmejean.pcl --------------------- Date: 2017.11.9 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.11.9 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.11.15 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2017.11.15 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS_PB.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2018.2.27 *** Developer: Bruno Bonte *** --------------------- SIS.pcl --------------------- Date: 2020.3.31 *** Developer: Bruno Bonte ***'	</body><body package="SIS" selector="vwCompatibleVersion">vwCompatibleVersion^ '7.6'	</body></methods><methods><class-id>CormasNS.Models.SIS.SIS class</class-id> <category>+ parameter unit</category><body package="SIS" selector="aggregInfected_type">aggregInfected_type 	"Return the type of attribute #aggregInfected.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^SmallInteger</body><body package="SIS" selector="aggregInfected_unit">aggregInfected_unit 	"Return the unit of attribute #aggregInfected.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ '%'</body><body package="SIS" selector="aggregSusceptibles_type">aggregSusceptibles_type 	"Return the type of attribute #aggregSusceptibles.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^SmallInteger</body><body package="SIS" selector="aggregSusceptibles_unit">aggregSusceptibles_unit 	"Return the unit of attribute #aggregSusceptibles.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ '%'</body><body package="SIS" selector="hostPopSize_type">hostPopSize_type 	"Return the type of attribute #hostPopSize.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^SmallInteger</body><body package="SIS" selector="hostPopSize_unit">hostPopSize_unit 	"Return the unit of attribute #hostPopSize.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ 'agents'</body><body package="SIS" selector="initPropInfectious_type">initPropInfectious_type 	"Return the type of attribute #initPropInfectious.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^SmallInteger</body><body package="SIS" selector="initPropInfectious_unit">initPropInfectious_unit 	"Return the unit of attribute #initPropInfectious.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ '%'</body><body package="SIS" selector="i_type">i_type 	"Return the type of attribute #i.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^SmallInteger</body><body package="SIS" selector="i_unit">i_unit 	"Return the unit of attribute #i.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ '%'</body><body package="SIS" selector="pInit_type">pInit_type 	"Return the type of attribute #pInit.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^SmallInteger</body><body package="SIS" selector="pInit_unit">pInit_unit 	"Return the unit of attribute #pInit.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ '%'</body><body package="SIS" selector="s_type">s_type 	"Return the type of attribute #s.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^SmallInteger</body><body package="SIS" selector="s_unit">s_unit 	"Return the unit of attribute #s.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^ '%'</body></methods><methods><class-id>CormasNS.Models.SIS.SIS class</class-id> <category>- default value</category><body package="SIS" selector="aggregInfected_default">aggregInfected_default 	"Return the default value of attribute #aggregInfected : 1.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^1</body><body package="SIS" selector="aggregSusceptibles_default">aggregSusceptibles_default 	"Return the default value of attribute #aggregSusceptibles : 99.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^99</body><body package="SIS" selector="hostPopSize_default">hostPopSize_default 	"Return the default value of attribute #hostPopSize : 1000.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^1000</body><body package="SIS" selector="infected_default">infected_default 	"Return the default value of attribute #infected : 0.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^0</body><body package="SIS" selector="initPropInfectious_default">initPropInfectious_default 	"Return the default value of attribute #initPropInfectious : 1.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^1</body><body package="SIS" selector="i_default">i_default 	"Return the default value of attribute #i : 0.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^0</body><body package="SIS" selector="pInit_default">pInit_default 	"Return the default value of attribute #pInit : 1.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^1</body><body package="SIS" selector="proportionInfectious_default">proportionInfectious_default 	"Return the default value of attribute #proportionInfectious : 1.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^1</body><body package="SIS" selector="susceptibles_default">susceptibles_default 	"Return the default value of attribute #susceptibles : 100.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^100</body><body package="SIS" selector="s_default">s_default 	"Return the default value of attribute #s : 100.		This method was automatically generated by Cormas.	!! BECAREFUL, You should not modify this method as it can be generated again when changing the value (Sensitivity Analysis for ex) !!"	^100</body></methods><methods><class-id>CormasNS.Models.SIS.SIS class</class-id> <category>- probes</category><body package="SIS" selector="colorOfProbe_aggregINFECTED">colorOfProbe_aggregINFECTED  ^ ColorValue orange</body><body package="SIS" selector="colorOfProbe_aggregSUSCEP">colorOfProbe_aggregSUSCEP  ^ ColorValue royalBlue</body><body package="SIS" selector="colorOfProbe_indivINFECTED">colorOfProbe_indivINFECTED  ^ ColorValue red</body><body package="SIS" selector="colorOfProbe_indivREMOVED">colorOfProbe_indivREMOVED  ^ ColorValue springGreen</body><body package="SIS" selector="colorOfProbe_indivSUSCEPT">colorOfProbe_indivSUSCEPT  ^ ColorValue blue</body><body package="SIS" selector="colorOfProbe_nR">colorOfProbe_nR  ^ ColorValue red</body><body package="SIS" selector="colorOfProbe_nS">colorOfProbe_nS  ^ (ColorValue red: 0.0 green: 0.500061 blue: 1.0)</body><body package="SIS" selector="colorOfProbe_pI">colorOfProbe_pI  ^ ColorValue salmon</body><body package="SIS" selector="colorOfProbe_prevalence">colorOfProbe_prevalence  ^ ColorValue springGreen</body><body package="SIS" selector="colorOfProbe_propInfectious">colorOfProbe_propInfectious  ^ (ColorValue red: 1.0 green: 0.0 blue: 0.500061)</body><body package="SIS" selector="colorOfProbe_pS">colorOfProbe_pS  ^ ColorValue blue</body></methods><do-it>"Imported Classes:"</do-it><do-it>self error: 'Attempting to file-in parcel imports.  Choose terminate or close'</do-it><class><name>SpatialEntityElement</name><environment>CormasNS.Kernel</environment><super>CormasNS.Kernel.SpatialEntity</super><private>false</private><indexed-type>none</indexed-type><inst-vars>orderedNeighbourhood </inst-vars><class-inst-vars></class-inst-vars><imports></imports><category>CormasKernel-Entities</category><attributes><package>Cormas</package></attributes></class><class><name>AgentLocation</name><environment>CormasNS.Kernel</environment><super>CormasNS.Kernel.Agent</super><private>false</private><indexed-type>none</indexed-type><inst-vars>patch </inst-vars><class-inst-vars></class-inst-vars><imports></imports><category>CormasKernel-Entities</category><attributes><package>Cormas</package></attributes></class><class><name>CormasModel</name><environment>CormasNS.Kernel</environment><super>UI.ApplicationModel</super><private>false</private><indexed-type>none</indexed-type><inst-vars>cormas timeStepValue channel activeInit activeControl spaceModel data simManager database collector defaultAttributesSetter sensitivitySetter delayedChanges allClassVarBOSS stepIsEnded </inst-vars><class-inst-vars>timeStep cellClass spatialClasses socialClasses passiveClasses povColorsDict visualStateIsOpen charts activeProbes activityDiagrams currentSimulation randUi autoUpdating threadDumps </class-inst-vars><imports></imports><category>CormasKernel-Interface</category><attributes><package>Cormas</package></attributes></class></st-source>